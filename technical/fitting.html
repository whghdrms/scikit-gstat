
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fitting a theoretical model &#8212; SciKit GStat 0.3.2 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Directional Variograms" href="direction.html" />
    <link rel="prev" title="Technical Notes" href="technical.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fitting-a-theoretical-model">
<h1>Fitting a theoretical model<a class="headerlink" href="#fitting-a-theoretical-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>The fit function of Variogram relies as of this writing on the
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit" title="(in SciPy v1.6.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit()</span></code></a> function. That function can
be used by ust passing a function and a set of x and y values and hoping for
the best. However, this will not always yield the best parameters. Especially
not for fitting a theoretical variogram function. There are a few assumptions
and simplifications, that we can state in order to utilize the function in a
more meaningful way.</p>
</div>
<div class="section" id="default-fit">
<h2>Default fit<a class="headerlink" href="#default-fit" title="Permalink to this headline">¶</a></h2>
<p>The example below shows the performance of the fully unconstrained fit,
performed by the Levenberg-Marquardt algorithm. In scikit-gstat, this can be
used by setting the <cite>fit_method</cite> parameter to <cite>lm</cite>. However, this is not
recommended.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="gp">In [3]: </span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">skgstat.models</span> <span class="kn">import</span> <span class="n">spherical</span>
</pre></div>
</div>
<p>The fit of a spherical model will be illustrated with some made-up data
representing an experimental variogram:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">13</span><span class="p">]</span>

<span class="gp">In [7]: </span><span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

<span class="gp">In [8]: </span><span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>As the <a class="reference internal" href="../reference/models.html#skgstat.models.spherical" title="skgstat.models.spherical"><code class="xref py py-func docutils literal notranslate"><span class="pre">spherical</span></code></a> function is compiled
using numba, we wrap the function in order to let
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit" title="(in SciPy v1.6.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">curve_fit</span></code></a> correctly infer the
parameters.
Then, fitting is a straightforward task.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">spherical</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [10]: </span><span class="n">cof_u</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">yi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">spherical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">cof_u</span><span class="p">),</span> <span class="n">xi</span><span class="p">))</span>

<span class="gp">In [12]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rD&#39;</span><span class="p">)</span>
<span class="gh">Out[12]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc3ac208&gt;]</span>

<span class="gp">In [13]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s1">&#39;--r&#39;</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc3b2fd0&gt;]</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/fit1.png"><img alt="../_images/fit1.png" src="../_images/fit1.png" style="width: 7in;" /></a>
<p>In fact this looks quite good. But Levenberg-Marquardt is an unconstrained
fitting algorithm and it could likely fail on finding a parameter set. The
<a class="reference internal" href="../reference/variogram.html#skgstat.Variogram.fit" title="skgstat.Variogram.fit"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit</span></code></a> method can therefore also run a box
constrained fitting algorithm. It is the Trust Region Reflective algorithm,
that will find parameters within a given range (box). It is set by the
<cite>fit_method=’tfr’</cite> parameter and also the default setting.</p>
</div>
<div class="section" id="constrained-fit">
<h2>Constrained fit<a class="headerlink" href="#constrained-fit" title="Permalink to this headline">¶</a></h2>
<p>The constrained fitting case was chosen to be the default method in skgstat
as the region can easily be specified. Furthermore it is possible to make
a good guess on initial values.
As we fit actual variogram parameters, namely the effective range, sill,
nugget and in case of a stable or Matérn model an additional shape parameter,
we know that these parameters cannot be zero. The semi-variance is defined to
be always positive.
Thus the lower bound of the region will be zero in any case. The upper limit
can easily be inferred from the experimental variogram. There are some simple
rules, that all theoretical functions follow:</p>
<blockquote>
<div><ul class="simple">
<li><p>the sill, nugget and their sum cannot be larger than the maximum
empirical semi-variance</p></li>
<li><p>the range cannot be larger than maxlag, or if maxlag is None the
maximum value in the distances</p></li>
</ul>
</div></blockquote>
<p>The <a class="reference internal" href="../reference/variogram.html#skgstat.Variogram" title="skgstat.Variogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variogram</span></code></a> class will set the bounds to
exactly these values as default behaviour. As an initial guess, it will use
the mean value of semi-variances for the sill, the mean separating distance
as range and 0 for the nugget.
In the presented empirical variogram, difference between Levenberg-Marquardt
and Trust Region Reflective is illustrated in the example below.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># default plot</span>
<span class="gp">In [14]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rD&#39;</span><span class="p">)</span>
<span class="gh">Out[14]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc35d240&gt;]</span>

<span class="gp">In [15]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s1">&#39;--g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;unconstrained&#39;</span><span class="p">)</span>
<span class="gh">Out[15]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc2dd320&gt;]</span>

<span class="gp">In [16]: </span><span class="n">cof</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">14.</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))))</span>

<span class="gp">In [17]: </span><span class="n">yi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">spherical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">cof</span><span class="p">),</span> <span class="n">xi</span><span class="p">))</span>

<span class="gp">In [18]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="gh">Out[18]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc2dd8d0&gt;]</span>

<span class="gp">In [19]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="gh">Out[19]: </span><span class="go">&lt;matplotlib.legend.Legend at 0x7febfc2d5898&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/fit2.png"><img alt="../_images/fit2.png" src="../_images/fit2.png" style="width: 7in;" /></a>
<p>The constrained fit, represented by the solid blue line is significantly
different from the unconstrained fit (dashed, green line). The fit is overall
better as a quick RMSE calculation shows:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">rmse_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">spherical</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">cof_u</span><span class="p">)</span> <span class="o">-</span> <span class="n">_</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]))</span>

<span class="gp">In [21]: </span><span class="n">rmse_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">spherical</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">cof</span><span class="p">)</span> <span class="o">-</span> <span class="n">_</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]))</span>

<span class="gp">In [22]: </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE unconstrained: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rmse_u</span><span class="p">)</span>
<span class="go">RMSE unconstrained: 18.65</span>

<span class="gp">In [23]: </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE constrained:   </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rmse_c</span><span class="p">)</span>
<span class="go">RMSE constrained:   17.42</span>
</pre></div>
</div>
<p>The last note about fitting a theoretical function, is that both methods
assume all lag classes to be equally important for the fit. In the specific
case of a variogram this is not true.</p>
</div>
<div class="section" id="distance-weighted-fit">
<h2>Distance weighted fit<a class="headerlink" href="#distance-weighted-fit" title="Permalink to this headline">¶</a></h2>
<p>While the standard Levenberg-Marquardt and Trust Region Reflective algorithms
are both based on the idea of least squares, they assume all observations to
be equally important. In the specific case of a theoretical variogram
function, this is not the case.
The variogram describes a dependency of covariance in value on the separation
distances of the observations. This model already implies that the dependency
is stronger on small distances. Considering a kriging interpolation as the
main application of the variogram model, points on close distances will get
higher weights for the interpolated value of an unobserved location. The
weight on large distances will be neglected anyway. Hence, a good fit on
small separating distances is way more important.
The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit" title="(in SciPy v1.6.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">curve_fit</span></code></a> function does not have an
option for weighting the squares of specific observations. At least it does
not call it ‘weights’. In terms of scipy, you can define a ‘sigma’, which is
the uncertainty of the respective point.
The uncertainty <span class="math notranslate nohighlight">\(\sigma\)</span> influences the least squares calculation as
described by the equation:</p>
<div class="math notranslate nohighlight">
\[\chi_{sq} = \sum {\left(\frac{r}{\sigma}\right)}^2\]</div>
<p>That means, the larger <span class="math notranslate nohighlight">\(\sigma\)</span> is, the <em>less</em> weight it will receive.
That also means, we can almost ignore points, by assigning a ridiculous high
<span class="math notranslate nohighlight">\(\sigma\)</span> to them. The following example should illustrate the effect.
This time, the first 7 points will be weighted by a weight
<span class="math notranslate nohighlight">\(\sigma = [0.1, 0.2, \ldots 0.9]\)</span> and the remaining points will receive a
<span class="math notranslate nohighlight">\(\sigma = 1\)</span>. In the case of <span class="math notranslate nohighlight">\(\sigma=0.1\)</span>, this would change the
least squares cost function to:</p>
<div class="math notranslate nohighlight">
\[\chi_{sq;x_{1:7}} = \sum (10r)^2\]</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;autumn_r&#39;</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="gp">In [26]: </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="gp">In [27]: </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rD&#39;</span><span class="p">)</span>
<span class="gh">Out[27]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc288ba8&gt;]</span>

<span class="gp">In [28]: </span><span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">s</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">   ....: </span>    <span class="n">s</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">*=</span> <span class="n">w</span>
<span class="gp">   ....: </span>    <span class="n">cof</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">yi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">spherical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">cof</span><span class="p">),</span> <span class="n">xi</span><span class="p">))</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cm</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;w = </span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">w</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [29]: </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="gh">Out[29]: </span><span class="go">&lt;matplotlib.legend.Legend at 0x7febfc288d68&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/fit3.png"><img alt="../_images/fit3.png" src="../_images/fit3.png" style="width: 7in;" /></a>
<p>In the figure above, you can see how the last points get more and more
ignored by the fitting. A smaller w value means more weight on the first 7
points. The more yellow lines have a smaller sill and range.</p>
<p>The <a class="reference internal" href="../reference/variogram.html#skgstat.Variogram" title="skgstat.Variogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variogram</span></code></a> class accepts lists like sigma
from the code example above as
<a class="reference internal" href="../reference/variogram.html#skgstat.Variogram.fit_sigma" title="skgstat.Variogram.fit_sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">Variogram.fit_sigma</span></code></a> property. This way,
the example from above could be implemented.
However, <a class="reference internal" href="../reference/variogram.html#skgstat.Variogram.fit_sigma" title="skgstat.Variogram.fit_sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">Variogram.fit_sigma</span></code></a> can also
apply a function of distance to the lag classes to derive the <span class="math notranslate nohighlight">\(\sigma\)</span>
values. There are several predefined functions.
These are:</p>
<blockquote>
<div><ul class="simple">
<li><p>sigma=’linear’: The residuals get weighted by the lag
distance normalized to the maximum lag distance, denoted as
<span class="math notranslate nohighlight">\(w_n\)</span></p></li>
<li><p>sigma=’exp’: The residuals get weighted by the function:
<span class="math notranslate nohighlight">\(w = e^{1 / w_n}\)</span></p></li>
<li><p>sigma=’sqrt’: The residuals get weighted by the function:
<span class="math notranslate nohighlight">\(w = \sqrt(w_n)\)</span></p></li>
<li><p>sigma=’sq’: The residuals get weighted by the function:
<span class="math notranslate nohighlight">\(w = w_n^2\)</span></p></li>
</ul>
</div></blockquote>
<p>The example below illustrates their effect on the sample experimental
variograms used so far.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_earth&#39;</span><span class="p">)</span>

<span class="go"># increase the distance by one, to aviod zeros</span>
<span class="gp">In [31]: </span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>

<span class="gp">In [32]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="gp">In [33]: </span><span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">X</span><span class="p">)</span>

<span class="gp">In [34]: </span><span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>

<span class="gp">In [35]: </span><span class="n">s4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="gp">In [36]: </span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;sq&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rD&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;experimental&#39;</span><span class="p">)</span>
<span class="gh">Out[38]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7febfc306518&gt;]</span>

<span class="gp">In [39]: </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">cof</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span><span class="mf">14.</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">)))</span>
<span class="gp">   ....: </span>    <span class="n">yi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">spherical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">cof</span><span class="p">),</span> <span class="n">xi</span><span class="p">))</span>
<span class="gp">   ....: </span>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cm</span><span class="p">((</span><span class="n">i</span><span class="o">/</span><span class="mi">6</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="gp">   ....: </span>

<span class="gp">In [40]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="gh">Out[40]: </span><span class="go">&lt;matplotlib.legend.Legend at 0x7febfc1ec240&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/fit4.png"><img alt="../_images/fit4.png" src="../_images/fit4.png" style="width: 7in;" /></a>
<p>That’s it.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SciKit GStat</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mmaelicke&repo=scikit-gstat&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/userguide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="technical.html">Technical Notes</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fitting a theoretical model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-fit">Default fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constrained-fit">Constrained fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distance-weighted-fit">Distance weighted fit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="direction.html">Directional Variograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="estimate_kriging.html">Kriging estimate mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Code Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://mmaelicke.github.io/scikit-gstat/SciKitGStat.pdf">Download PDF</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="technical.html">Technical Notes</a><ul>
      <li>Previous: <a href="technical.html" title="previous chapter">Technical Notes</a></li>
      <li>Next: <a href="direction.html" title="next chapter">Directional Variograms</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Mirko Mälicke.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/technical/fitting.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>